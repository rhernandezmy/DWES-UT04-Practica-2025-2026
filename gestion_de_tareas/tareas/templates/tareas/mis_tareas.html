<!-- templates/tareas/mis_tareas.html -->
<h1>Mis Tareas</h1>

{% comment %} Tareas individuales {% endcomment %}
{% if tareas_individuales %}
    <h2>Tareas Individuales</h2>
    <ul>
    {% for tarea in tareas_individuales %}
        <li>
            <strong>{{ tarea.titulo }}</strong> - {{ tarea.descripcion|default:"Sin descripci√≥n" }}<br>
            Fecha de entrega: {{ tarea.fecha_entrega|date:"d/m/Y H:i" }}<br>
            Estado: {% if tarea.completada %}Completada{% else %}Pendiente{% endif %}<br>
            Creador: {{ tarea.creador.username }}<br>
            Asignada a: {{ tarea.asignado_a.username }}<br>

            {% if not tarea.completada %}
                {% if usuario.es_profesor or (usuario.es_alumno and not tarea.necesita_evaluacion) %}
                    <form method="post" action="{% url 'completar_tarea' 'individual' tarea.id %}">
                        {% csrf_token %}
                        <button type="submit">Marcar como completada</button>
                    </form>
                {% endif %}
            {% endif %}
        </li>
        <hr>
    {% endfor %}
    </ul>
{% else %}
    <p>No tienes tareas individuales asignadas o creadas.</p>
{% endif %}

{% comment %} Tareas grupales {% endcomment %}
{% if tareas_grupales %}
    <h2>Tareas Grupales</h2>
    <ul>
    {% for tarea in tareas_grupales %}
        <li>
            <strong>{{ tarea.titulo }}</strong> - {{ tarea.descripcion|default:"Sin descripci√≥n" }}<br>
            Fecha de entrega: {{ tarea.fecha_entrega|date:"d/m/Y H:i" }}<br>
            Estado: {% if tarea.completada %}Completada{% else %}Pendiente{% endif %}<br>
            Creador: {{ tarea.creador.username }}<br>
            Grupo: {{ tarea.grupo.nombre }}<br>

            {% if not tarea.completada %}
                {% if usuario.es_profesor or (usuario.es_alumno and not tarea.necesita_evaluacion) %}
                    <form method="post" action="{% url 'completar_tarea' 'grupal' tarea.id %}">
                        {% csrf_token %}
                        <button type="submit">Marcar como completada</button>
                    </form>
                {% endif %}
            {% endif %}
        </li>
        <hr>
    {% endfor %}
    </ul>
{% else %}
    <p>No tienes tareas grupales asignadas o creadas.</p>
{% endif %}

{% comment %} Tareas evaluables {% endcomment %}
{% if tareas_evaluables %}
    <h2>Tareas Evaluables</h2>
    <ul>
    {% for tarea in tareas_evaluables %}
        <li>
            <strong>{{ tarea.titulo }}</strong> - {{ tarea.descripcion|default:"Sin descripci√≥n" }}<br>
            Fecha de entrega: {{ tarea.fecha_entrega|date:"d/m/Y H:i" }}<br>
            Estado: {% if tarea.completada %}Completada{% else %}Pendiente{% endif %}<br>
            Creador: {{ tarea.creador.username }}<br>
            Alumno asignado: {{ tarea.asignado_a.username|default:"No asignado" }}<br>
            Profesor validador: {{ tarea.profesor_validador.username|default:"No asignado" }}<br>

            {% if not tarea.completada %}
                {% if usuario.es_profesor or usuario.is_superuser %}
                    <form method="post" action="{% url 'completar_tarea' 'evaluable' tarea.id %}">
                        {% csrf_token %}
                        <button type="submit">Marcar como completada</button>
                    </form>
                {% endif %}
            {% endif %}
        </li>
        <hr>
    {% endfor %}
    </ul>
{% else %}
    <p>No tienes tareas evaluables asignadas o creadas.</p>
{% endif %}

<p><a href="{% url 'dashboard' %}">üè† Ir al Dashboard</a></p>

